# AWS RDS 백업 시간 문제 해결 가이드

## 문제 상황
AWS RDS는 UTC 시간을 기준으로 백업을 수행하는데, 한국은 UTC+9이므로 9시간의 차이가 있습니다.
이로 인해 다음과 같은 문제들이 발생할 수 있습니다:

1. **백업 시간대 문제**: 한국 시간으로 새벽 3시에 백업이 실행되어 서비스 중단
2. **Maintenance 윈도우 문제**: 한국 시간으로 새벽에 유지보수 작업이 실행됨
3. **성능 저하**: 백업 중 I/O 성능 저하

## 해결 방법

### 1. RDS 백업 시간 조정

#### 현재 설정 확인
```bash
python fix_rds_backup_time.py --action check
```

#### 백업 시간 조정 (한국 시간 오후 2시로 설정)
```bash
python fix_rds_backup_time.py --action adjust
```

### 2. 권장 백업 시간 설정

- **백업 시간**: 한국 시간 오후 2시 (UTC 오전 5시)
  - 이유: 업무 시간이 끝나고 서버 부하가 적은 시간
  - 한국 사용자들에게 미치는 영향 최소화

- **유지보수 윈도우**: 한국 시간 일요일 새벽 3시-4시
  - 이유: 주말 새벽 시간으로 서비스 영향 최소화

### 3. AWS 콘솔에서 직접 설정

1. AWS RDS 콘솔 접속
2. 해당 인스턴스 선택
3. "수정" 클릭
4. "백업" 섹션에서:
   - **백업 보존 기간**: 7일
   - **백업 윈도우**: `05:00-06:00` (UTC, 한국 시간 14:00-15:00)
   - **유지보수 윈도우**: `sun:03:00-sun:04:00` (한국 시간 기준)

### 4. 애플리케이션 레벨 개선사항

#### 시간대 처리 개선
- 모든 날짜/시간을 UTC로 저장
- 한국 시간대 변환 로직 추가
- 백업 시간대를 고려한 크롤링 스케줄링

#### 크롤링 스케줄 조정
```bash
# 백업 시간을 피해서 크롤링 실행
# 한국 시간 오전 9시-오후 1시, 오후 3시-오후 6시에 크롤링 실행
python sisaon_crawler_with_ranking.py --mode crawl --pages 2
```

### 5. 모니터링 및 알림 설정

#### CloudWatch 알림 설정
- 백업 시작/완료 알림
- 성능 지표 모니터링
- 오류 발생 시 알림

#### 로그 모니터링
```bash
# 백업 관련 로그 확인
grep -i "backup\|maintenance" sisaon_crawler.log
```

## 추가 권장사항

### 1. 다중 AZ 설정 고려
- 고가용성 향상
- 백업 시 서비스 중단 최소화

### 2. 읽기 전용 복제본 활용
- 백업 부하 분산
- 읽기 성능 향상

### 3. 스냅샷 백업 활용
- 수동 백업으로 추가 보안
- 장기 보관 필요 시 활용

## 실행 예시

```bash
# 1. 현재 설정 확인
python fix_rds_backup_time.py --action check

# 2. 백업 시간 조정
python fix_rds_backup_time.py --action adjust

# 3. 크롤링 실행 (백업 시간 피해서)
python sisaon_crawler_with_ranking.py --mode crawl --pages 1

# 4. 결과 확인
python sisaon_crawler_with_ranking.py --mode rank
```

## 주의사항

1. **백업 시간 조정은 즉시 적용되지 않습니다**
   - 다음 유지보수 윈도우에 적용됨
   - `ApplyImmediately=True`로 즉시 적용 가능하지만 권장하지 않음

2. **백업 중 성능 저하**
   - 백업 시간대에는 크롤링 작업을 피하는 것이 좋음
   - 읽기 전용 복제본 활용 고려

3. **비용 고려사항**
   - 백업 보관 기간에 따른 비용 증가
   - 필요에 따라 보관 기간 조정 